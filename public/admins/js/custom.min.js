$(function() {
    "use strict";
    $(function() {
        $(".preloader").fadeOut();
    }), jQuery(document).on("click", ".mega-dropdown", function(e) {
        e.stopPropagation();
    });
    var set = function() {
        (window.innerWidth > 0 ? window.innerWidth : this.screen.width) < 1170 ? ($("body").addClass("mini-sidebar"), 
            $(".navbar-brand span").hide(), $(".sidebartoggler i").addClass("ti-menu")) : ($("body").removeClass("mini-sidebar"), 
            $(".navbar-brand span").show());
            var height = (window.innerHeight > 0 ? window.innerHeight : this.screen.height) - 1;
            (height -= 0) < 1 && (height = 1), height > 0 && $(".page-wrapper").css("min-height", height + "px");
        };
        $(window).ready(set), $(window).on("resize", set), $(".sidebartoggler").on("click", function() {
            $("body").hasClass("mini-sidebar") ? ($("body").trigger("resize"), $("body").removeClass("mini-sidebar"), 
                $(".navbar-brand span").show()) : ($("body").trigger("resize"), $("body").addClass("mini-sidebar"), 
                $(".navbar-brand span").hide());
            }), $(".nav-toggler").click(function() {
                $("body").toggleClass("show-sidebar"), $(".nav-toggler i").toggleClass("ti-menu"), 
                $(".nav-toggler i").addClass("ti-close");
            }), $(".search-box a, .search-box .app-search .srh-btn").on("click", function() {
                $(".app-search").toggle(200);
            }), $(".right-side-toggle").click(function() {
                $(".right-sidebar").slideDown(50), $(".right-sidebar").toggleClass("shw-rside");
            }), $(".floating-labels .form-control").on("focus blur", function(e) {
                $(this).parents(".form-group").toggleClass("focused", "focus" === e.type || this.value.length > 0);
            }).trigger("blur"), $(function() {
                for (var url = window.location, element = $("ul#sidebarnav a").filter(function() {
                    return this.href == url;
                }).addClass("active").parent().addClass("active"); ;) {
                    if (!element.is("li")) break;
                    element = element.parent().addClass("in").parent().addClass("active");
                }
            }), $(function() {
                $('[data-toggle="tooltip"]').tooltip();
            }), $(function() {
                $('[data-toggle="popover"]').popover();
            }), $(function() {
                $("#sidebarnav").AdminMenu();
            }), //$(".scroll-sidebar, .right-side-panel, .message-center, .right-sidebar").perfectScrollbar(),
            $(".scroll-sidebar").mCustomScrollbar({
                setHeight: 550,
                autoHideScrollbar: true,
                scrollbarPosition: "outside",
                theme:"dark-1" 
            }),
            $("body").trigger("resize"), $(".list-task li label").click(function() {
                $(this).toggleClass("task-done");
            }), $('a[data-action="collapse"]').on("click", function(e) {
                e.preventDefault(), $(this).closest(".card").find('[data-action="collapse"] i').toggleClass("ti-minus ti-plus"), 
                $(this).closest(".card").children(".card-body").collapse("toggle");
            }), $('a[data-action="expand"]').on("click", function(e) {
                e.preventDefault(), $(this).closest(".card").find('[data-action="expand"] i').toggleClass("mdi-arrow-expand mdi-arrow-compress"), 
                $(this).closest(".card").toggleClass("card-fullscreen");
            }), $('a[data-action="close"]').on("click", function() {
                $(this).closest(".card").removeClass().slideUp("fast");
            });
        });

$(".sidebartoggler").on("click", function() {
    if (window.innerWidth>1000) {
        if (!$('.dark-logo').hasClass("logo-min")) {
            $('.dark-logo').addClass('logo-min');
            $('.dark-logo').attr('width', '60');
        } else {
            $('.dark-logo').removeClass('logo-min');
            $('.dark-logo').attr('width', '100');
        }
    } else {
        if ($('.dark-logo').hasClass("logo-min")) {
            $('.dark-logo').removeClass('logo-min');
        } else {
            $('.dark-logo').addClass('logo-min');
        }
        $('.dark-logo').attr('width', '60');
    }
    
});

$(window).resize(function(event) {
    if (window.innerWidth>1169) {
        $('.dark-logo').removeClass('logo-min');
        $('.dark-logo').attr('width', '100');
    } else {
        $('.dark-logo').addClass('logo-min');
        $('.dark-logo').attr('width', '60');
    }
});

$(document).ready(function() {
    //Validación para introducir solo números
    $('.number, #phone, #dni').keypress(function() {
        return event.charCode >= 48 && event.charCode <= 57;
    });
    //Validación para introducir solo letras y espacios
    $('#name, #lastname').keypress(function() {
        return event.charCode >= 65 && event.charCode <= 90 || event.charCode >= 97 && event.charCode <= 122 || event.charCode==32;
    });
    //Validación para solo presionar enter y borrar
    $('.date').keypress(function() {
        return event.charCode == 32 || event.charCode == 127;
    });

    if (window.innerWidth>1169) {
        $('.dark-logo').removeClass('logo-min');
        $('.dark-logo').attr('width', '100');
    } else {
        $('.dark-logo').addClass('logo-min');
        $('.dark-logo').attr('width', '60');
    }

    //datatable español
    var español = {
        "sProcessing":     "Procesando...",
        "sLengthMenu":     "Mostrar _MENU_ registros",
        "sZeroRecords":    "No se encontraron resultados",
        "sEmptyTable":     "Ningún resultado disponible en esta tabla",
        "sInfo":           "Resultados del _START_ al _END_ de un total de _TOTAL_ registros",
        "sInfoEmpty":      "No hay resultados",
        "sInfoFiltered":   "(filtrado de un total de _MAX_ registros)",
        "sInfoPostFix":    "",
        "sSearch":         "Buscar :",
        "sUrl":            "",
        "sInfoThousands":  ",",
        "sLoadingRecords": "Cargando...",
        "oPaginate": {
            "sFirst":    "Primero",
            "sLast":     "Último",
            "sNext":     "Siguiente",
            "sPrevious": "Anterior"
        },
        "oAria": {
            "sSortAscending":  ": Activar para ordenar la columna de manera ascendente",
            "sSortDescending": ": Activar para ordenar la columna de manera descendente"
        }
    }

    //datatable export
    if ($('#tablaExport').length) {
        $('#tablaExport').DataTable({
            dom: 'Bfrtip',
            buttons: ['excel', 'pdf'],
            "language": español
        });
    }

    //datatable normal
    if ($('#tabla').length) {
        $('#tabla').DataTable({
            "language": español
        });
    }

    //datepicker material
    if ($('.date').length) {
        $('.date').bootstrapMaterialDatePicker({
            time: false,
            cancelText: 'Cancelar',
            clearText: 'Limpiar',
            format: 'D-M-YYYY',
            minDate : new Date()
        });
    }

    //multiselect
    if ($('.multiselect').length) {
        $('.multiselect').multiselect({
            buttonClass: 'form-control',
            buttonWidth: '100%',
            maxHeight: 200,
            includeSelectAllOption: false,
            selectAllText: 'Seleccionar Todas',
            enableFiltering: true,
            enableCaseInsensitiveFiltering: true,
            filterPlaceholder: 'Buscar',
            includeFilterClearBtn: true,
            nonSelectedText: 'Seleccione',
            nSelectedText: 'Selecionados',
            allSelectedText: 'Todos Selecionados',
            numberDisplayed: 2,
            disableIfEmpty: true,
            disabledText: 'Seleccione',
            templates: {
                button: '<button type="button" style="text-align: left;" class="multiselect dropdown-toggle" data-toggle="dropdown"><span class="multiselect-selected-text"></span> <b class="caret" style="text-align: right;"></b></button>',
                ul: '<ul class="multiselect-container dropdown-menu"></ul>',
                filter: '<li class="multiselect-item multiselect-filter"><div class="input-group"><span class="input-group-addon"><i class="fa fa-search"></i></span><input class="form-control multiselect-search" type="text" /></div></li>',
                filterClearBtn: '<span class="input-group-btn"><button class="btn btn-default multiselect-clear-filter" type="button"><i class="fa fa-close"></i></button></span>',
                li: '<li style="margin-left: -25px;"><a tabindex="0"><label style="color: #000; width: 100%;"></label></a></li>',
                divider: '<li class="multiselect-item divider"></li>',
                liGroup: '<li class="multiselect-item multiselect-group"><label></label></li>',
                resetButton: '<li class="multiselect-reset text-center"><div class="input-group"><a class="btn btn-default btn-block"></a></div></li>'
            }
        });
    }

    //touchspin para los campos numericos
    if ($('.price').length) {
        $(".price").TouchSpin({
            min: 0,
            max: 99999999999,
            decimals: 2,
            postfix: 'Bs',
            buttondown_class: 'btn btn-primary',
            buttonup_class: 'btn btn-primary'
        });
    }

    if ($('.km').length) {
        $(".km").TouchSpin({
            min: 0,
            max: 99999,
            step: 0.1,
            decimals: 1,
            postfix: 'Km',
            buttondown_class: 'btn btn-primary',
            buttonup_class: 'btn btn-primary'
        });
    }

    //dropify para input file más personalizado
    if ($('.dropify').length) {
        $('.dropify').dropify({
            messages: {
                default: 'Arrastre y suelte una imagen o da click para seleccionarla',
                replace: 'Arrastre y suelte una imagen o haga click para reemplazar',
                remove: 'Remover',
                error: 'Lo sentimos, el archivo es demasiado grande'
            },
            error: {
                'fileSize': 'El tamaño del archivo es demasiado grande ({{ value }} máximo).',
                'minWidth': 'El ancho de la imagen es demasiado pequeño ({{ value }}}px mínimo).',
                'maxWidth': 'El ancho de la imagen es demasiado grande ({{ value }}}px máximo).',
                'minHeight': 'La altura de la imagen es demasiado pequeña ({{ value }}}px mínimo).',
                'maxHeight': 'La altura de la imagen es demasiado grande ({{ value }}px máximo).',
                'imageFormat': 'El formato de imagen no está permitido (Debe ser {{ value }}).'
            }
        });
    }

    if ($('#countdown').length) {
        $("#countdown").timer('remove');
        $("#countdown").timer({
            countdown: true,
            duration: $("#minutes").val()+"m"+$("#seconds").val()+"s",
            format: "%M:%S"
        });
    }
});

//funciones para desactivar y activar usuarios
function deactiveUser(slug) {
    $("#deactiveUser").modal();
    $('#formDeactiveUser').attr('action', '/maesma/usuarios/desactivar/' + slug);
}

function activeUser(slug) {
    $("#activeUser").modal();
    $('#formActiveUser').attr('action', '/maesma/usuarios/activar/' + slug);
}

//funciones para desactivar y activar tiendas
function desactivateStore(slug) {
    $("#desactivateStore").modal();
    $('#formDesactiveStore').attr('action', '/maesma/tiendas/desactivar/' + slug);
}

function activateStore(slug) {
    $("#activateStore").modal();
    $('#formActiveStore').attr('action', '/maesma/tiendas/activar/' + slug);
}

//funciones para preguntar al eliminar
function deleteCategory(slug) {
    $("#deleteCategory").modal();
    $('#formDeleteCategory').attr('action', '/maesma/categorias/eliminar/' + slug);
}

function deleteStore(slug) {
    $("#deleteStore").modal();
    $('#formDeleteStore').attr('action', '/maesma/tiendas/' + slug);
}

function deleteProduct(slug) {
    $("#deleteProduct").modal();
    $('#formDeleteProduct').attr('action', '/maesma/productos/eliminar/' + slug);
}

function deleteDistance(slug) {
    $("#deleteDistance").modal();
    $('#formDeleteDistance').attr('action', '/maesma/distancias/eliminar/' + slug);
}

///////////////////////////////////////Ventas//////////////////////////////

function confirmUsers(slug) {
    $("#confirmUsers").modal();
    $('#formConfirmUsers').attr('action', '/maesma/ventas/cajero-repartidor/' + slug);
}

function confirmState(slug) {
    $("#confirmState").modal();
    $('#formConfirmState').attr('action', '/maesma/ventas/estado/' + slug);
}

function confirmTime(slug) {
    $("#confirmTime").modal();
    $('#formConfirmTime').attr('action', '/maesma/ventas/tiempo/' + slug);
}

$('select[name="size-question"]').change(function() {
    if ($(this).val()==0) {
        $('#div-select-size').addClass('d-none');
        $('#price-unique').removeClass('d-none');
        $("#newSizes div").remove();
        $('#select-size option').removeClass("d-none");
        $('#select-size').val("");
        $('#btn-select-size').attr('disabled', true);
        $('button[type="submit"]').attr('disabled', false);
    } else {
        $('#price-unique').addClass('d-none');
        $('#div-select-size').removeClass('d-none');
        $('button[type="submit"]').attr('disabled', true);
    }
});

$('#select-size').change(function() {
    if ($(this).val()=="") {
        $('#btn-select-size').attr('disabled', true);
    } else {
        $('#btn-select-size').attr('disabled', false);
    }
});

$('#btn-select-size').click(function() {
    var size=$('#select-size').val();
    $("#newSizes").append($('<div>', {
        class: "form-group col-lg-2 col-md-2 col-12 size",
        size: size
    }).append($('<label>', {
        class: "col-form-label",
        text: "Tamaño"
    })).append($('<input>', {
        type: 'text',
        class: "form-control",
        disabled: "disabled",
        value: $('#select-size option:selected').text()
    })).append($('<input>', {
        type: 'hidden',
        class: "form-control",
        name: "size[]",
        value: size
    })));

    $("#newSizes").append($('<div>', {
        class: "form-group col-lg-3 col-md-3 col-9 size",
        size: size
    }).append($('<label>', {
        class: "col-form-label",
        text: "Precio"
    }).append($('<b>', {
        class: "text-danger",
        text: "*"
    }))).append($('<input>', {
        class: "form-control price",
        name: "price[]",
        required: "required",
        value: 0.00
    })));

    $("#newSizes").append($('<div>', {
        class: "form-group col-lg-1 col-md-1 col-3 size",
        size: size
    }).append($('<button>', {
        type: "button",
        class: "btn btn-danger mt-4 deleteSize",
        size: size
    }).append($('<i>', {
        class: "fa fa-close"
    }))));

    $(".price").TouchSpin({
        min: 0,
        max: 99999999999,
        decimals: 2,
        postfix: 'Bs',
        buttondown_class: 'btn btn-primary',
        buttonup_class: 'btn btn-primary'
    });

    //Quitar tamaño de producto
    $('.deleteSize').on("click", function() {
        var size=$(this).attr('size');
        $('.size[size="'+size+'"]').remove();
        $('#select-size option[value="'+size+'"]').removeClass('d-none');
        if ($('.size').length) {
            $('button[type="submit"]').attr('disabled', false);
        } else {
            $('button[type="submit"]').attr('disabled', true);
        }
    });

    $('#select-size option[value="'+size+'"]').addClass('d-none');
    $('#select-size').val('');
    $('#btn-select-size').attr('disabled', true);
    $('button[type="submit"]').attr('disabled', false);
});

//Quitar tamaño de producto
$('.deleteSize').click(function() {
    var size=$(this).attr('size');
    $('.size[size="'+size+'"]').remove();
    $('#select-size option[value="'+size+'"]').removeClass('d-none');
    if ($('.size').length) {
        $('button[type="submit"]').attr('disabled', false);
    } else {
        $('button[type="submit"]').attr('disabled', true);
    }
});

 //Mostrar u ocultar campo de tienda en registro y edición de usuarios
 $('#typeUser').change(function() {
    var typeUser=$('#typeUser').val();
    if (typeUser==2 || $typerUser==3) {
        $('#storeField').removeClass('d-none');
    } else {
        $('#storeField').addClass('d-none');
    }
});